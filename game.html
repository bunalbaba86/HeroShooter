<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover" />
<meta name="mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="theme-color" content="#2c3e50">
<title>Kryptomon Battle Arena</title>

<!-- Socket.io CDN -->
<script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>

<style>
  * {
    margin: 0;
    padding: 0;
    box-sizing: border-box;
    -webkit-tap-highlight-color: transparent;
    user-select: none;
    -webkit-user-select: none;
  }

  body {
    font-family: 'Arial', sans-serif;
    background: url('background.png') center/cover no-repeat fixed,
                linear-gradient(45deg, #8B4513, #D2691E);
    color: #fff;
    overflow: hidden;
    height: 100vh;
    width: 100vw;
    position: fixed;
    top: 0;
    left: 0;
  }

  /* Dynamic backgrounds */
  body.bg1 { background: url('background.png') center/cover no-repeat fixed; }
  body.bg2 { background: url('background2.png') center/cover no-repeat fixed; }
  body.bg3 { background: url('background3.png') center/cover no-repeat fixed; }
  body.bg4 { background: url('background4.png') center/cover no-repeat fixed; }

  /* Connection Status - Mobile optimized */
  .connection-status {
    position: fixed;
    top: 5px;
    right: 5px;
    padding: 4px 8px;
    border-radius: 12px;
    font-size: 10px;
    font-weight: bold;
    z-index: 9999;
    transition: all 0.3s ease;
  }

  .connection-status.connected { background: #2ecc71; color: white; }
  .connection-status.disconnected { background: #e74c3c; color: white; }
  .connection-status.connecting { background: #f39c12; color: white; }

  /* Player Name Selection Screen - FULL WIDTH */
  #player-name-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: 10px;
  }

  #player-name-modal {
    background: linear-gradient(135deg, #2c3e50 0%, #3498db 100%);
    padding: 40px 30px;
    border-radius: 20px;
    text-align: center;
    width: 95%;
    max-width: 500px;
    box-shadow: 0 25px 50px rgba(0,0,0,0.5);
  }

  #player-name-input {
    width: 100%;
    padding: 15px;
    font-size: 18px;
    border: 2px solid #3498db;
    border-radius: 10px;
    margin: 20px 0;
    background: rgba(255,255,255,0.9);
    color: #2c3e50;
    text-align: center;
  }

  #set-name-btn, #guest-mode-btn {
    width: 100%;
    padding: 15px 20px;
    border: none;
    border-radius: 10px;
    font-size: 16px;
    font-weight: bold;
    cursor: pointer;
    margin: 10px 0;
    transition: all 0.3s ease;
  }

  #set-name-btn {
    background: linear-gradient(45deg, #2ecc71, #27ae60);
    color: white;
  }

  #guest-mode-btn {
    background: linear-gradient(45deg, #95a5a6, #7f8c8d);
    color: white;
  }

  /* Waiting Screen - FULL WIDTH & HEIGHT */
  #waiting-container, #metamask-container, #nft-selection-container {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.95);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 1000;
  }

  .waiting-split {
    display: flex;
    flex-direction: column;
    width: 100%;
    height: 100vh;
    position: relative;
  }

  .waiting-left, .waiting-right {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
    padding: 40px 20px;
    width: 100%;
  }

  .waiting-left {
    background: linear-gradient(45deg, rgba(52, 152, 219, 0.3), rgba(41, 128, 185, 0.5));
    border-bottom: 2px solid rgba(255,255,255,0.3);
  }

  .waiting-right {
    background: linear-gradient(45deg, rgba(231, 76, 60, 0.3), rgba(192, 57, 43, 0.5));
  }

  .vs-divider {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 80px;
    color: #FFD700;
    text-shadow: 0 0 30px rgba(255, 215, 0, 0.8);
    z-index: 10;
    animation: pulse 2s infinite;
  }

  .waiting-player-name {
    font-size: 24px;
    font-weight: bold;
    color: #FFD700;
    margin-bottom: 15px;
  }

  .waiting-status {
    font-size: 18px;
    margin-bottom: 20px;
  }

  .waiting-player-icon {
    font-size: 100px;
    margin-bottom: 20px;
    animation: bounce 2s infinite;
  }

  .question-mark {
    font-size: 120px;
    color: #ccc;
    margin-bottom: 20px;
    animation: bounce 2s infinite;
  }

  /* Game Start Countdown - FULL SCREEN */
  .game-start-countdown {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0,0,0,0.9);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 150px;
    color: #FFD700;
    font-weight: bold;
    text-shadow: 0 0 40px rgba(255, 215, 0, 1);
    z-index: 5000;
    animation: countdownPulse 1s infinite;
    backdrop-filter: blur(10px);
  }

  /* Game Arena - FULL WIDTH & HEIGHT */
  #game-container {
    width: 100vw;
    height: 100vh;
    position: relative;
    display: none;
  }

  .dojo-bg {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: linear-gradient(180deg, rgba(0,0,0,0.2) 0%, rgba(0,0,0,0.4) 100%);
  }

  /* Turn Info - Top Center */
  .turn-info {
    position: absolute;
    top: 15px;
    left: 50%;
    transform: translateX(-50%);
    background: rgba(0,0,0,0.9);
    color: white;
    padding: 12px 24px;
    border-radius: 25px;
    font-size: 16px;
    font-weight: bold;
    backdrop-filter: blur(10px);
    border: 2px solid #FFD700;
    z-index: 100;
    text-align: center;
  }

  .turn-timer {
    color: #FFD700;
    font-size: 18px;
    margin-top: 5px;
  }

  /* HP Bars - Top corners */
  .hp-bar-container {
    position: absolute;
    top: 80px;
    background: rgba(0,0,0,0.9);
    padding: 15px 20px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.2);
    z-index: 100;
    display: flex;
    align-items: center;
    gap: 15px;
    min-width: 280px;
  }

  .hp-bar-container.left {
    left: 20px;
  }

  .hp-bar-container.right {
    right: 20px;
  }

  .hp-kryptomon-image {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 3px solid #FFD700;
    object-fit: cover;
    background: #333;
  }

  .hp-stats {
    flex: 1;
  }

  .hp-stat-value {
    color: #fff;
    font-size: 14px;
    margin-bottom: 5px;
    font-weight: bold;
  }

  .hp-bar-modern {
    width: 100%;
    height: 8px;
    background: rgba(255,255,255,0.2);
    border-radius: 4px;
    overflow: hidden;
  }

  .hp-fill-modern {
    height: 100%;
    background: linear-gradient(90deg, #27ae60, #2ecc71);
    transition: width 0.3s ease;
  }

  /* Character Images - Bottom corners */
  .character-image {
    position: absolute;
    bottom: 200px;
    z-index: 50;
    display: flex;
    align-items: center;
    gap: 12px;
    background: rgba(0,0,0,0.8);
    padding: 15px 20px;
    border-radius: 15px;
    backdrop-filter: blur(10px);
    border: 2px solid rgba(255,255,255,0.2);
  }

  .character-image.left {
    left: 20px;
  }

  .character-image.right {
    right: 20px;
  }

  .character-profile-image {
    width: 50px;
    height: 50px;
    border-radius: 50%;
    border: 3px solid #FFD700;
    object-fit: cover;
    background: #333;
  }

  .character-name {
    color: #FFD700;
    font-size: 16px;
    font-weight: bold;
  }

  .mana-stat-value {
    color: #3498db;
    font-size: 14px;
    font-weight: bold;
  }

  /* Kryptomon Team Selection - Sides */
  .kryptomon-team {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    display: flex;
    flex-direction: column;
    gap: 15px;
    z-index: 80;
  }

  .kryptomon-team.left {
    left: 20px;
  }

  .kryptomon-team.right {
    right: 20px;
  }

  .kryptomon-slot {
    width: 70px;
    height: 70px;
    border: 3px solid rgba(255,255,255,0.3);
    border-radius: 15px;
    background: rgba(0,0,0,0.8);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    backdrop-filter: blur(5px);
  }

  .kryptomon-slot.active {
    border-color: #2ecc71;
    box-shadow: 0 0 20px rgba(46, 204, 113, 0.5);
  }

  .kryptomon-slot.dead {
    opacity: 0.3;
    border-color: #e74c3c;
    cursor: not-allowed;
    pointer-events: none;
  }

  .kryptomon-slot img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: 12px;
    background: #333;
  }

  /* Battle Arena - FULL CENTER STAGE */
  .battle-arena {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 30;
    gap: 120px; /* Wider gap for full screen */
  }

  .trainer {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .kryptomon-sprite {
    width: 280px; /* BIGGER SIZE */
    height: 280px;
    object-fit: contain;
    transition: all 0.3s ease;
    filter: drop-shadow(0 10px 20px rgba(0,0,0,0.5));
  }

  /* Rakip Kryptomon'u ters Ã§evir */
  .trainer.right .kryptomon-sprite {
    transform: scaleX(-1);
  }

  /* ENHANCED ANIMATIONS - Full screen optimized */
  .kryptomon-sprite.attack {
    animation: fullScreenAttackAnimation 1.2s ease-in-out;
  }

  @keyframes fullScreenAttackAnimation {
    0% { transform: translateX(0) scale(1); filter: drop-shadow(0 0 0px #e74c3c) brightness(1); }
    25% { transform: translateX(30px) scale(1.1); filter: drop-shadow(0 0 20px #e74c3c) brightness(1.3); }
    50% { transform: translateX(50px) scale(1.15) rotate(8deg); filter: drop-shadow(0 0 30px #e74c3c) brightness(1.5); }
    75% { transform: translateX(30px) scale(1.1); filter: drop-shadow(0 0 20px #e74c3c) brightness(1.3); }
    100% { transform: translateX(0) scale(1); filter: drop-shadow(0 0 0px #e74c3c) brightness(1); }
  }

  .trainer.right .kryptomon-sprite.attack {
    animation: fullScreenAttackAnimationRight 1.2s ease-in-out;
  }

  @keyframes fullScreenAttackAnimationRight {
    0% { transform: scaleX(-1) translateX(0) scale(1); filter: drop-shadow(0 0 0px #e74c3c) brightness(1); }
    25% { transform: scaleX(-1) translateX(30px) scale(1.1); filter: drop-shadow(0 0 20px #e74c3c) brightness(1.3); }
    50% { transform: scaleX(-1) translateX(50px) scale(1.15) rotate(-8deg); filter: drop-shadow(0 0 30px #e74c3c) brightness(1.5); }
    75% { transform: scaleX(-1) translateX(30px) scale(1.1); filter: drop-shadow(0 0 20px #e74c3c) brightness(1.3); }
    100% { transform: scaleX(-1) translateX(0) scale(1); filter: drop-shadow(0 0 0px #e74c3c) brightness(1); }
  }

  .kryptomon-sprite.skill {
    animation: fullScreenSkillAnimation 2s ease-in-out;
  }

  @keyframes fullScreenSkillAnimation {
    0% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #9b59b6) brightness(1); }
    20% { transform: scale(1.15) rotate(8deg); filter: drop-shadow(0 0 25px #9b59b6) brightness(1.4) hue-rotate(60deg); }
    40% { transform: scale(1.25) rotate(-8deg); filter: drop-shadow(0 0 40px #9b59b6) brightness(1.6) hue-rotate(120deg); }
    60% { transform: scale(1.2) rotate(5deg); filter: drop-shadow(0 0 35px #9b59b6) brightness(1.5) hue-rotate(180deg); }
    80% { transform: scale(1.1) rotate(-3deg); filter: drop-shadow(0 0 20px #9b59b6) brightness(1.3) hue-rotate(240deg); }
    100% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #9b59b6) brightness(1); }
  }

  .trainer.right .kryptomon-sprite.skill {
    animation: fullScreenSkillAnimationRight 2s ease-in-out;
  }

  @keyframes fullScreenSkillAnimationRight {
    0% { transform: scaleX(-1) scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #9b59b6) brightness(1); }
    20% { transform: scaleX(-1) scale(1.15) rotate(-8deg); filter: drop-shadow(0 0 25px #9b59b6) brightness(1.4) hue-rotate(60deg); }
    40% { transform: scaleX(-1) scale(1.25) rotate(8deg); filter: drop-shadow(0 0 40px #9b59b6) brightness(1.6) hue-rotate(120deg); }
    60% { transform: scaleX(-1) scale(1.2) rotate(-5deg); filter: drop-shadow(0 0 35px #9b59b6) brightness(1.5) hue-rotate(180deg); }
    80% { transform: scaleX(-1) scale(1.1) rotate(3deg); filter: drop-shadow(0 0 20px #9b59b6) brightness(1.3) hue-rotate(240deg); }
    100% { transform: scaleX(-1) scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #9b59b6) brightness(1); }
  }

  /* EPIC ULTIMATE ANIMATION - Full screen */
  .kryptomon-sprite.ultimate {
    animation: fullScreenUltimateAnimation 4s ease-in-out;
  }

  @keyframes fullScreenUltimateAnimation {
    0% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #f1c40f) brightness(1) hue-rotate(0deg); }
    10% { transform: scale(1.3) rotate(20deg); filter: drop-shadow(0 0 50px #f1c40f) brightness(2) hue-rotate(60deg); }
    20% { transform: scale(1.5) rotate(-25deg); filter: drop-shadow(0 0 70px #f1c40f) brightness(2.5) hue-rotate(120deg); }
    30% { transform: scale(1.7) rotate(30deg); filter: drop-shadow(0 0 90px #f1c40f) brightness(3) hue-rotate(180deg); }
    50% { transform: scale(1.9) rotate(-35deg); filter: drop-shadow(0 0 110px #f1c40f) brightness(3.5) hue-rotate(240deg); }
    70% { transform: scale(1.6) rotate(25deg); filter: drop-shadow(0 0 80px #f1c40f) brightness(2.8) hue-rotate(300deg); }
    85% { transform: scale(1.3) rotate(-15deg); filter: drop-shadow(0 0 50px #f1c40f) brightness(2) hue-rotate(330deg); }
    100% { transform: scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #f1c40f) brightness(1) hue-rotate(360deg); }
  }

  .trainer.right .kryptomon-sprite.ultimate {
    animation: fullScreenUltimateAnimationRight 4s ease-in-out;
  }

  @keyframes fullScreenUltimateAnimationRight {
    0% { transform: scaleX(-1) scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #f1c40f) brightness(1) hue-rotate(0deg); }
    10% { transform: scaleX(-1) scale(1.3) rotate(-20deg); filter: drop-shadow(0 0 50px #f1c40f) brightness(2) hue-rotate(60deg); }
    20% { transform: scaleX(-1) scale(1.5) rotate(25deg); filter: drop-shadow(0 0 70px #f1c40f) brightness(2.5) hue-rotate(120deg); }
    30% { transform: scaleX(-1) scale(1.7) rotate(-30deg); filter: drop-shadow(0 0 90px #f1c40f) brightness(3) hue-rotate(180deg); }
    50% { transform: scaleX(-1) scale(1.9) rotate(35deg); filter: drop-shadow(0 0 110px #f1c40f) brightness(3.5) hue-rotate(240deg); }
    70% { transform: scaleX(-1) scale(1.6) rotate(-25deg); filter: drop-shadow(0 0 80px #f1c40f) brightness(2.8) hue-rotate(300deg); }
    85% { transform: scaleX(-1) scale(1.3) rotate(15deg); filter: drop-shadow(0 0 50px #f1c40f) brightness(2) hue-rotate(330deg); }
    100% { transform: scaleX(-1) scale(1) rotate(0deg); filter: drop-shadow(0 0 0px #f1c40f) brightness(1) hue-rotate(360deg); }
  }

  /* Game Controls - Bottom center, WIDER */
  .game-controls {
    position: absolute;
    bottom: 30px;
    left: 50%;
    transform: translateX(-50%);
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 15px;
    z-index: 100;
    width: 85%;
    max-width: 400px;
  }

  .control-btn {
    background: linear-gradient(135deg, #3498db, #2980b9);
    color: white;
    border: none;
    padding: 18px 12px;
    border-radius: 15px;
    font-size: 14px;
    font-weight: bold;
    cursor: pointer;
    transition: all 0.3s ease;
    border: 2px solid rgba(255,255,255,0.3);
    min-height: 60px;
    display: flex;
    align-items: center;
    justify-content: center;
    flex-direction: column;
  }

  .control-btn:active {
    transform: scale(0.95);
    box-shadow: 0 4px 15px rgba(52, 152, 219, 0.4);
  }

  .control-btn:disabled {
    background: #95a5a6;
    cursor: not-allowed;
    transform: none;
    opacity: 0.6;
  }

  .control-btn.mana-gain {
    background: linear-gradient(135deg, #27ae60, #2ecc71);
  }

  .control-btn.mana-cost {
    background: linear-gradient(135deg, #e74c3c, #c0392b);
  }

  /* Responsive adjustments for smaller screens */
  @media (max-height: 700px) {
    .kryptomon-sprite {
      width: 220px;
      height: 220px;
    }
    
    .battle-arena {
      gap: 100px;
    }
    
    .character-image {
      bottom: 160px;
    }
    
    .game-controls {
      bottom: 20px;
    }
  }

  @media (max-width: 500px) {
    .kryptomon-sprite {
      width: 200px;
      height: 200px;
    }
    
    .battle-arena {
      gap: 80px;
    }
    
    .hp-bar-container {
      min-width: 220px;
      padding: 12px 15px;
    }
    
    .control-btn {
      font-size: 12px;
      padding: 15px 10px;
      min-height: 50px;
    }
  }

  /* Keyframe animations */
  @keyframes bounce {
    0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
    40% { transform: translateY(-20px); }
    60% { transform: translateY(-10px); }
  }

  @keyframes pulse {
    0%, 100% { transform: translate(-50%, -50%) scale(1); }
    50% { transform: translate(-50%, -50%) scale(1.1); }
  }

  @keyframes countdownPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
  }
</style>
</head>
<body>
  <!-- Connection Status -->
  <div id="connection-status" class="connection-status disconnected">Disconnected</div>

  <!-- Player Name Selection Screen -->
  <div id="player-name-container">
    <div id="player-name-modal">
      <h1>ð¾ Kryptomon Battle Arena</h1>
      <p>Enter your player name to start battling!</p>
      <input type="text" id="player-name-input" placeholder="Enter your name" maxlength="20">
      <button id="set-name-btn" disabled>Connect Wallet & Select NFTs</button>
      <button id="guest-mode-btn">Play as Guest</button>
    </div>
  </div>

  <!-- MetaMask Connection Modal -->
  <div id="metamask-container">
    <div id="metamask-modal">
      <h2>ð¦ Connect MetaMask Wallet</h2>
      <p>Connect your MetaMask wallet to select your Kryptomon NFTs for battle!</p>
      <button id="connect-wallet-btn">Connect MetaMask</button>
    </div>
  </div>

  <!-- NFT Selection Modal -->
  <div id="nft-selection-container">
    <div id="nft-selection-modal">
      <h2>ð¯ Select Your Battle Team</h2>
      <p>Choose 3 Kryptomon NFTs from your collection to form your battle team!</p>
      <div id="nft-grid"></div>
      <div style="margin-top: 20px;">
        <button id="refresh-nfts-btn">ð Refresh NFTs</button>
        <button id="select-nft-btn" disabled>Start Battle!</button>
      </div>
    </div>
  </div>

  <!-- Waiting for Opponent Screen -->
  <div id="waiting-container">
    <div class="waiting-screen">
      <div class="waiting-split">
        <div class="waiting-left">
          <div class="waiting-player-icon">ð¤</div>
          <div class="waiting-player-name" id="waiting-player-name">You</div>
          <div class="waiting-status">Ready to Battle!</div>
        </div>
        <div class="waiting-right">
          <div class="question-mark">â</div>
          <div class="waiting-player-name">Searching...</div>
          <div class="waiting-status">Finding opponent...</div>
        </div>
        <div class="vs-divider">VS</div>
      </div>
    </div>
  </div>

  <!-- Game Arena -->
  <div id="game-container">
    <div class="dojo-bg"></div>

    <!-- Turn Info -->
    <div class="turn-info">
      <div>Turn: Player 1</div>
      <div class="turn-timer">30s</div>
    </div>

    <!-- HP Bars -->
    <div class="hp-bar-container left">
      <img class="hp-kryptomon-image" src="kryptomon1.png" alt="Your Kryptomon">
      <div class="hp-stats">
        <div class="hp-stat">
          <div class="hp-stat-value">HP: 100/100</div>
          <div class="hp-bar-modern">
            <div class="hp-fill-modern" style="width: 100%"></div>
          </div>
        </div>
        <div class="hp-stat">
          <div class="hp-stat-value">MP: 100/100</div>
          <div class="hp-bar-modern">
            <div class="hp-fill-modern" style="width: 100%; background: linear-gradient(90deg, #3498db, #2980b9);"></div>
          </div>
        </div>
      </div>
    </div>

    <div class="hp-bar-container right">
      <img class="hp-kryptomon-image" src="kryptomon2.png" alt="Enemy Kryptomon">
      <div class="hp-stats">
        <div class="hp-stat">
          <div class="hp-stat-value">HP: 100/100</div>
          <div class="hp-bar-modern">
            <div class="hp-fill-modern" style="width: 100%"></div>
          </div>
        </div>
        <div class="hp-stat">
          <div class="hp-stat-value">MP: 100/100</div>
          <div class="hp-bar-modern">
            <div class="hp-fill-modern" style="width: 100%; background: linear-gradient(90deg, #3498db, #2980b9);"></div>
          </div>
        </div>
      </div>
    </div>

    <!-- Character Info -->
    <div class="character-image left">
      <img class="character-profile-image" src="you.jpg" alt="You">
      <div>
        <div class="character-name">Player 1</div>
        <div class="mana-stat-value">ð® Mana: 100</div>
      </div>
    </div>

    <div class="character-image right">
      <img class="character-profile-image" src="enemy.jpg" alt="Enemy">
      <div>
        <div class="character-name">Player 2</div>
        <div class="mana-stat-value">ð® Mana: 100</div>
      </div>
    </div>

    <!-- Kryptomon Teams -->
    <div class="kryptomon-team left">
      <div class="kryptomon-slot active">
        <img src="kryptomon1.png" alt="Your Kryptomon 1">
      </div>
      <div class="kryptomon-slot">
        <img src="kryptomon2.png" alt="Your Kryptomon 2">
      </div>
      <div class="kryptomon-slot">
        <img src="kryptomon3.png" alt="Your Kryptomon 3">
      </div>
    </div>

    <div class="kryptomon-team right">
      <div class="kryptomon-slot active">
        <img src="kryptomon4.png" alt="Enemy Kryptomon 1">
      </div>
      <div class="kryptomon-slot">
        <img src="kryptomon5.png" alt="Enemy Kryptomon 2">
      </div>
      <div class="kryptomon-slot">
        <img src="kryptomon6.png" alt="Enemy Kryptomon 3">
      </div>
    </div>

    <!-- Battle Arena -->
    <div class="battle-arena">
      <div class="trainer left">
        <img class="kryptomon-sprite" src="kryptomon1.png" alt="Your Kryptomon">
      </div>

      <div class="trainer right">
        <img class="kryptomon-sprite" src="kryptomon4.png" alt="Enemy Kryptomon">
      </div>
    </div>

    <!-- Game Controls -->
    <div class="game-controls">
      <button class="control-btn mana-cost" id="attack-btn">
        âï¸ Attack
        <small>-10 MP</small>
      </button>

      <button class="control-btn mana-cost" id="defend-btn">
        ð¡ï¸ Defend
        <small>-5 MP</small>
      </button>

      <button class="control-btn mana-cost" id="skill-btn">
        â¨ Skill
        <small>-20 MP</small>
      </button>

      <button class="control-btn mana-cost" id="ultimate-btn">
        ð¥ Ultimate
        <small>-40 MP</small>
      </button>

      <button class="control-btn mana-gain" id="mana-btn">
        ð® Restore Mana
        <small>+25 MP</small>
      </button>

      <button class="control-btn" id="surrender-btn">
        ð³ï¸ Surrender
      </button>
    </div>
  </div>

<script>
// Backend server URL
const BACKEND_URL = 'https://pvpbackend.onrender.com';

// Game state
let socket = null;
let gameState = {
  connected: false,
  playerName: '',
  isGuest: false,
  inGame: false,
  gameRoom: null,
  yourIndex: null
};

// DOM elements
const connectionStatus = document.getElementById('connection-status');
const playerNameContainer = document.getElementById('player-name-container');
const playerNameInput = document.getElementById('player-name-input');
const setNameBtn = document.getElementById('set-name-btn');
const guestModeBtn = document.getElementById('guest-mode-btn');
const waitingContainer = document.getElementById('waiting-container');
const gameContainer = document.getElementById('game-container');

// Control buttons
const attackBtn = document.getElementById('attack-btn');
const defendBtn = document.getElementById('defend-btn');
const skillBtn = document.getElementById('skill-btn');
const ultimateBtn = document.getElementById('ultimate-btn');
const manaBtn = document.getElementById('mana-btn');
const surrenderBtn = document.getElementById('surrender-btn');

// Connection management
function updateConnectionStatus(status) {
  connectionStatus.className = `connection-status ${status}`;
  switch(status) {
    case 'connecting':
      connectionStatus.textContent = 'Connecting...';
      break;
    case 'connected':
      connectionStatus.textContent = 'Connected';
      break;
    case 'disconnected':
      connectionStatus.textContent = 'Disconnected';
      break;
    case 'error':
      connectionStatus.textContent = 'Connection Error';
      break;
  }
}

// Initialize socket connection
function initializeSocket() {
  updateConnectionStatus('connecting');
  
  socket = io(BACKEND_URL, {
    withCredentials: true,
    timeout: 10000,
    transports: ['websocket', 'polling']
  });

  socket.on('connect', () => {
    console.log('Connected to server');
    gameState.connected = true;
    updateConnectionStatus('connected');
  });

  socket.on('disconnect', () => {
    console.log('Disconnected from server');
    gameState.connected = false;
    updateConnectionStatus('disconnected');
  });

  socket.on('connect_error', (error) => {
    console.error('Connection error:', error);
    updateConnectionStatus('error');
  });

  // Game events
  socket.on('waitingForOpponent', (data) => {
    console.log('Waiting for opponent:', data);
    showWaitingScreen();
  });

  socket.on('gameStartCountdown', (data) => {
    console.log('Game starting in:', data.countdown);
    showCountdown(data.countdown);
  });

  socket.on('gameStart', (data) => {
    console.log('Game started:', data);
    gameState.inGame = true;
    gameState.gameRoom = data.gameRoom;
    gameState.yourIndex = data.yourIndex;
    hideAllScreens();
    showGameScreen();
    updateGameUI(data.gameRoom);
  });

  socket.on('turnResult', (data) => {
    console.log('Turn result:', data);
    updateGameUI(data.gameRoom);
    // Add animation effects here
  });

  socket.on('gameEnd', (data) => {
    console.log('Game ended:', data);
    showGameEndScreen(data);
  });

  socket.on('error', (error) => {
    console.error('Game error:', error);
    alert('Error: ' + error.message);
  });
}

// UI Management
function hideAllScreens() {
  playerNameContainer.style.display = 'none';
  waitingContainer.style.display = 'none';
  gameContainer.style.display = 'none';
}

function showWaitingScreen() {
  hideAllScreens();
  waitingContainer.style.display = 'flex';
  document.getElementById('waiting-player-name').textContent = gameState.playerName;
}

function showGameScreen() {
  hideAllScreens();
  gameContainer.style.display = 'block';
}

function showCountdown(count) {
  // Remove existing countdown
  const existing = document.querySelector('.game-start-countdown');
  if (existing) existing.remove();
  
  if (count > 0) {
    const countdown = document.createElement('div');
    countdown.className = 'game-start-countdown';
    countdown.textContent = count;
    document.body.appendChild(countdown);
    
    // Remove after 1 second
    setTimeout(() => {
      if (countdown.parentNode) {
        countdown.parentNode.removeChild(countdown);
      }
    }, 1000);
  }
}

function updateGameUI(gameRoom) {
  if (!gameRoom || !gameState.yourIndex !== null) return;
  
  const yourData = gameRoom.players[gameState.yourIndex];
  const enemyData = gameRoom.players[1 - gameState.yourIndex];
  
  // Update HP bars and other UI elements
  console.log('Updating UI for:', yourData, enemyData);
  
  // Enable/disable buttons based on turn
  const isYourTurn = gameRoom.currentTurn === gameState.yourIndex;
  updateButtonStates(isYourTurn, yourData);
}

function updateButtonStates(isYourTurn, playerData) {
  const currentKryptomon = playerData.team[playerData.currentKryptomon];
  
  attackBtn.disabled = !isYourTurn || currentKryptomon.mana < 10;
  defendBtn.disabled = !isYourTurn || currentKryptomon.mana < 5;
  skillBtn.disabled = !isYourTurn || currentKryptomon.mana < 20;
  ultimateBtn.disabled = !isYourTurn || currentKryptomon.mana < 40 || currentKryptomon.ultimateUsed;
  manaBtn.disabled = !isYourTurn;
  surrenderBtn.disabled = false;
}

function showGameEndScreen(data) {
  const isWinner = data.winner === gameState.yourIndex;
  alert(isWinner ? 'You Won! ð' : 'You Lost! ð¢');
  
  // Reset game state
  gameState.inGame = false;
  gameState.gameRoom = null;
  gameState.yourIndex = null;
  
  // Show waiting screen again
  showWaitingScreen();
}

// Event listeners
playerNameInput.addEventListener('input', () => {
  const name = playerNameInput.value.trim();
  setNameBtn.disabled = name.length < 2;
});

setNameBtn.addEventListener('click', () => {
  // For now, just redirect to guest mode
  startGuestMode();
});

guestModeBtn.addEventListener('click', startGuestMode);

function startGuestMode() {
  const name = playerNameInput.value.trim() || 'Guest';
  gameState.playerName = name;
  gameState.isGuest = true;
  
  hideAllScreens();
  
  if (socket && gameState.connected) {
    socket.emit('joinGame', {
      username: name,
      isGuest: true
    });
  } else {
    // Try to connect first
    initializeSocket();
    setTimeout(() => {
      if (socket && gameState.connected) {
        socket.emit('joinGame', {
          username: name,
          isGuest: true
        });
      } else {
        alert('Connection failed. Please try again.');
        playerNameContainer.style.display = 'flex';
      }
    }, 2000);
  }
}

// Battle controls
attackBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    socket.emit('battleMove', { moveType: 'attack' });
  }
});

defendBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    socket.emit('battleMove', { moveType: 'defend' });
  }
});

skillBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    socket.emit('battleMove', { moveType: 'skill' });
  }
});

ultimateBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    socket.emit('battleMove', { moveType: 'ultimate' });
  }
});

manaBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    socket.emit('battleMove', { moveType: 'manaRestore' });
  }
});

surrenderBtn.addEventListener('click', () => {
  if (socket && gameState.inGame) {
    if (confirm('Are you sure you want to surrender?')) {
      socket.emit('surrender');
    }
  }
});

// Initialize when page loads
document.addEventListener('DOMContentLoaded', () => {
  updateConnectionStatus('disconnected');
  initializeSocket();
});

// Random background rotation
function rotateBackground() {
  const backgrounds = ['bg1', 'bg2', 'bg3', 'bg4'];
  const randomBg = backgrounds[Math.floor(Math.random() * backgrounds.length)];
  document.body.className = randomBg;
}

// Change background every 30 seconds
setInterval(rotateBackground, 30000);
rotateBackground(); // Set initial background
</script>
</body>
</html>
