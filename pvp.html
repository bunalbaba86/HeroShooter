<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>1v1 PvP Sava≈ü</title>
  <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
  <style>
    body { font-family: sans-serif; text-align: center; margin-top: 20px; }
    button { margin: 5px; padding: 10px 20px; font-size: 16px; }
    .disabled { opacity: 0.5; pointer-events: none; }
    #log { margin-top: 20px; max-height: 200px; overflow-y: auto; border: 1px solid #ccc; padding: 10px; }
  </style>
</head>
<body>

<h2>1v1 PvP Sava≈ü</h2>

<div id="status">E≈üle≈üme bekleniyor...</div>

<h3>Sen</h3>
<div id="yourStats">HP: - | Mana: -</div>

<h3>Rakip</h3>
<div id="enemyStats">HP: - | Mana: -</div>

<div>
  <button id="attackBtn">Saldƒ±r</button>
  <button id="defendBtn">Savun</button>
  <button id="skillBtn">B√ºy√ºk Saldƒ±rƒ±</button>
  <button id="manaBtn">Mana Topla</button>
</div>

<h3>Sohbet</h3>
<input type="text" id="chatInput" placeholder="Mesaj yaz...">
<button id="sendBtn">G√∂nder</button>

<div id="log"></div>

<script>
const socket = io("http://localhost:3000");

let yourIndex = null;
let isMyTurn = false;

const statusEl = document.getElementById('status');
const yourStats = document.getElementById('yourStats');
const enemyStats = document.getElementById('enemyStats');
const log = document.getElementById('log');

const buttons = {
  attack: document.getElementById('attackBtn'),
  defend: document.getElementById('defendBtn'),
  skill: document.getElementById('skillBtn'),
  mana: document.getElementById('manaBtn')
};

function updateButtons(enabled) {
  for (let btn of Object.values(buttons)) {
    btn.disabled = !enabled;
    btn.classList.toggle('disabled', !enabled);
  }
}

updateButtons(false);

socket.on('waitingForOpponent', () => {
  statusEl.textContent = 'Rakip bekleniyor...';
});

socket.on('gameStart', ({ yourIndex: idx, you, enemy }) => {
  yourIndex = idx;
  isMyTurn = idx === 0; // ƒ∞lk oyuncu ba≈ülar
  updateButtons(isMyTurn);
  statusEl.textContent = isMyTurn ? "Senin sƒ±ran!" : "Rakip d√º≈ü√ºn√ºyor...";
  updateStats(you, enemy);
  logMessage("üéÆ Oyun ba≈üladƒ±!");
});

socket.on('moveConfirmed', ({ you, enemy }) => {
  isMyTurn = false;
  updateButtons(false);
  updateStats(you, enemy);
  statusEl.textContent = "Rakip d√º≈ü√ºn√ºyor...";
  logMessage("‚úÖ Hamlen uygulandƒ±.");
});

socket.on('enemyMove', ({ you, enemy }) => {
  isMyTurn = true;
  updateButtons(true);
  updateStats(enemy, you); // bizim i√ßin ters
  statusEl.textContent = "Senin sƒ±ran!";
  logMessage("‚ùó Rakip hamle yaptƒ±.");
});

socket.on('errorMessage', msg => {
  alert("Hata: " + msg);
});

socket.on('gameOver', ({ winner }) => {
  const msg = winner === 'player' ? 'Kazandƒ±n!' : 'Kaybettin!';
  statusEl.textContent = "üéØ " + msg;
  updateButtons(false);
  logMessage("üèÅ Oyun bitti: " + msg);
});

socket.on('chatMessage', ({ message, fromIndex }) => {
  logMessage("üí¨ Rakip: " + message);
});

document.getElementById('sendBtn').onclick = () => {
  const input = document.getElementById('chatInput');
  const message = input.value.trim();
  if (message !== '') {
    socket.emit('chatMessage', { message });
    logMessage("Sen: " + message);
    input.value = '';
  }
};

buttons.attack.onclick = () => sendMove('attack');
buttons.defend.onclick = () => sendMove('defend');
buttons.skill.onclick = () => sendMove('skill');
buttons.mana.onclick = () => sendMove('mana');

function sendMove(move) {
  if (isMyTurn) {
    socket.emit('playerMove', { move });
  }
}

function updateStats(you, enemy) {
  yourStats.textContent = `HP: ${you.health} | Mana: ${you.mana}`;
  enemyStats.textContent = `HP: ${enemy.health} | Mana: ${enemy.mana}`;
}

function logMessage(msg) {
  const div = document.createElement('div');
  div.textContent = msg;
  log.appendChild(div);
  log.scrollTop = log.scrollHeight;
}
</script>
</body>
</html>
