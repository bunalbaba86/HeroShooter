<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1v1 PvP Turn-based Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; text-align: center; }
  #game { margin-top: 30px; }
  button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  #status { margin-top: 20px; font-size: 18px; }
  #players { display: flex; justify-content: center; margin-top: 20px; gap: 40px; }
  .player-box { padding: 10px; border: 1px solid #555; width: 180px; background: #333; border-radius: 10px; }
  .bar { height: 20px; background: #444; margin: 8px 0; border-radius: 5px; overflow: hidden; }
  .health-bar { background: #e74c3c; height: 100%; }
  .mana-bar { background: #3498db; height: 100%; }
  .character-img { width: 100%; height: auto; border-radius: 10px; margin-bottom: 10px; }
  button:disabled { background: #555; color: #999; cursor: not-allowed; }
  #log { margin-top: 30px; text-align: left; max-width: 600px; margin-left: auto; margin-right: auto; background: #111; padding: 10px; border-radius: 10px; height: 150px; overflow-y: auto; }
  #victory-msg { font-size: 32px; color: gold; display: none; margin-top: 20px; }
</style>
</head>
<body>

<h1>1v1 PvP Turn-Based Game</h1>
<div id="status">Connecting to server...</div>

<div id="players" style="display:none;">
  <div class="player-box">
    <h2>You</h2>
    <img id="player-img" class="character-img" src="https://placehold.co/150x150?text=You" />
    <div>Health: <span id="player-health">0</span></div>
    <div class="bar"><div id="player-health-bar" class="health-bar" style="width:100%"></div></div>
    <div>Mana: <span id="player-mana">0</span></div>
    <div class="bar"><div id="player-mana-bar" class="mana-bar" style="width:100%"></div></div>
  </div>
  <div class="player-box">
    <h2>Enemy</h2>
    <img id="enemy-img" class="character-img" src="https://placehold.co/150x150?text=Enemy" />
    <div>Health: <span id="enemy-health">0</span></div>
    <div class="bar"><div id="enemy-health-bar" class="health-bar" style="width:100%"></div></div>
    <div>Mana: <span id="enemy-mana">0</span></div>
    <div class="bar"><div id="enemy-mana-bar" class="mana-bar" style="width:100%"></div></div>
  </div>
</div>

<div id="game" style="display:none;">
  <button id="attack-btn">Attack (Cost: 10 Mana)</button>
  <button id="defend-btn">Defend (Cost: 5 Mana)</button>
  <button id="skill-btn">Skill (Cost: 20 Mana)</button>
  <button id="mana-btn">Mana Boost (+15 Mana)</button>
</div>

<div id="log"></div>
<div id="victory-msg">Victory!</div>
<audio id="victory-audio" src="https://cdn.pixabay.com/download/audio/2022/08/10/audio_234f6a53d6.mp3?filename=small-victory-116165.mp3"></audio>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
  const socket = io('https://pvpbackend.onrender.com');
  const statusDiv = document.getElementById('status');
  const playersDiv = document.getElementById('players');
  const gameDiv = document.getElementById('game');
  const logDiv = document.getElementById('log');
  const victoryMsg = document.getElementById('victory-msg');
  const victoryAudio = document.getElementById('victory-audio');

  const playerHealthSpan = document.getElementById('player-health');
  const enemyHealthSpan = document.getElementById('enemy-health');
  const playerManaSpan = document.getElementById('player-mana');
  const enemyManaSpan = document.getElementById('enemy-mana');
  const playerHealthBar = document.getElementById('player-health-bar');
  const enemyHealthBar = document.getElementById('enemy-health-bar');
  const playerManaBar = document.getElementById('player-mana-bar');
  const enemyManaBar = document.getElementById('enemy-mana-bar');
  const attackBtn = document.getElementById('attack-btn');
  const defendBtn = document.getElementById('defend-btn');
  const skillBtn = document.getElementById('skill-btn');
  const manaBtn = document.getElementById('mana-btn');

  let isMyTurn = false;
  let player = null;
  let enemy = null;
  let lastMoveTime = 0;

  function updateUI() {
    playerHealthSpan.textContent = player.health;
    enemyHealthSpan.textContent = enemy.health;
    playerManaSpan.textContent = player.mana;
    enemyManaSpan.textContent = enemy.mana;

    playerHealthBar.style.width = player.health + '%';
    enemyHealthBar.style.width = enemy.health + '%';
    playerManaBar.style.width = (player.mana / 50 * 100) + '%';
    enemyManaBar.style.width = (enemy.mana / 50 * 100) + '%';

    attackBtn.disabled = !isMyTurn || player.mana < 10;
    defendBtn.disabled = !isMyTurn || player.mana < 5;
    skillBtn.disabled = !isMyTurn || player.mana < 20;
    manaBtn.disabled = !isMyTurn || player.mana >= 50;
  }

  function setStatus(text) {
    statusDiv.textContent = text;
  }

  function logAction(text) {
    const entry = document.createElement('div');
    entry.textContent = text;
    logDiv.appendChild(entry);
    logDiv.scrollTop = logDiv.scrollHeight;
  }

  socket.on('connect', () => setStatus('Connected. Waiting for opponent...'));
  socket.on('waitingForOpponent', () => setStatus('Waiting for opponent...'));

  socket.on('gameStart', (data) => {
    player = data.player;
    enemy = data.enemy;
    isMyTurn = true;
    playersDiv.style.display = 'flex';
    gameDiv.style.display = 'block';
    updateUI();
    setStatus('Game started! Your turn.');
    logDiv.innerHTML = '';
  });

  socket.on('moveConfirmed', (data) => {
    player = data.player;
    enemy = data.enemy;
    isMyTurn = false;
    updateUI();
    logAction(`[You] used ${data.move}`);
    setStatus("Opponent's turn. Please wait...");
  });

  socket.on('enemyMove', (data) => {
    player = data.enemy;
    enemy = data.player;
    isMyTurn = true;
    updateUI();
    logAction(`[Enemy] used ${data.move}`);
    setStatus('Your turn.');
  });

  socket.on('errorMessage', (msg) => alert(msg));

  socket.on('gameOver', (data) => {
    isMyTurn = false;
    updateUI();
    if(data.winner === 'player') {
      setStatus('You won the game! ðŸŽ‰');
      victoryMsg.style.display = 'block';
      victoryAudio.play();
    } else {
      setStatus('You lost the game.');
      logAction('You were defeated.');
    }
  });

  function canMakeMove() {
    const now = Date.now();
    if(now - lastMoveTime < 2000) {
      alert("Please wait before making another move.");
      return false;
    }
    lastMoveTime = now;
    return true;
  }

  function sendMove(move) {
    if (!isMyTurn) {
      alert("It's not your turn!");
      return;
    }
    if (!canMakeMove()) return;
    socket.emit('playerMove', { move });
  }

  attackBtn.onclick = () => sendMove('attack');
  defendBtn.onclick = () => sendMove('defend');
  skillBtn.onclick = () => sendMove('skill');
  manaBtn.onclick = () => sendMove('mana');
</script>
</body>
</html>
