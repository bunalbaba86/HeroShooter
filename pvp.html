<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Turn Based PvP</title>
  <script src="/socket.io/socket.io.js"></script>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #111;
      color: #fff;
      text-align: center;
      padding: 20px;
    }
    #game {
      display: none;
      margin-top: 20px;
    }
    #status {
      margin-top: 10px;
      font-size: 20px;
      color: #0f0;
    }
    #chat {
      margin-top: 20px;
      background: #222;
      padding: 10px;
      border-radius: 8px;
      width: 300px;
      margin-left: auto;
      margin-right: auto;
    }
    #chatMessages {
      height: 100px;
      overflow-y: scroll;
      margin-bottom: 10px;
      text-align: left;
    }
    #chatInput {
      width: 70%;
      padding: 5px;
    }
    #sendChat {
      padding: 5px 10px;
    }
    .you {
      color: #0ff;
    }
    .enemy {
      color: #f0f;
    }
    #actions button {
      padding: 10px;
      margin: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    #actions button:disabled {
      background-color: #555;
      color: #999;
    }
  </style>
</head>
<body>
  <h1>Turn Based PvP Game</h1>
  <div id="waiting">Waiting for another player to join...</div>
  <div id="game">
    <div>
      <h2>You</h2>
      <p id="youHealth">Health: 100</p>
      <p id="youMana">Mana: 0</p>
    </div>
    <div>
      <h2>Enemy</h2>
      <p id="enemyHealth">Health: 100</p>
      <p id="enemyMana">Mana: 0</p>
    </div>
    <div id="status">Waiting...</div>
    <div id="actions">
      <button id="attackBtn">Attack</button>
      <button id="manaBtn">Mana</button>
    </div>
    <div id="chat">
      <div id="chatMessages"></div>
      <input id="chatInput" placeholder="Type a message..." />
      <button id="sendChat">Send</button>
    </div>
  </div>

  <script>
    const socket = io();
    const waitingDiv = document.getElementById('waiting');
    const gameDiv = document.getElementById('game');
    const statusDiv = document.getElementById('status');
    const attackBtn = document.getElementById('attackBtn');
    const manaBtn = document.getElementById('manaBtn');
    const chatInput = document.getElementById('chatInput');
    const sendChat = document.getElementById('sendChat');
    const chatMessages = document.getElementById('chatMessages');
    const youHealthLabel = document.getElementById('youHealth');
    const enemyHealthLabel = document.getElementById('enemyHealth');
    const youManaLabel = document.getElementById('youMana');
    const enemyManaLabel = document.getElementById('enemyMana');

    let playerId;
    let isMyTurn = false;

    function updateUI(data) {
      const yourData = data[playerId];
      const enemyId = Object.keys(data).find(id => id !== playerId);
      const enemyData = data[enemyId];

      youHealthLabel.textContent = `Health: ${yourData.health}`;
      youManaLabel.textContent = `Mana: ${yourData.mana}`;
      enemyHealthLabel.textContent = `Health: ${enemyData.health}`;
      enemyManaLabel.textContent = `Mana: ${enemyData.mana}`;
    }

    function setTurn(turn) {
      isMyTurn = turn;
      statusDiv.textContent = isMyTurn ? 'Your Turn' : 'Enemy Turn';
      attackBtn.disabled = !isMyTurn;
      manaBtn.disabled = !isMyTurn;
    }

    function addChatMessage(message, senderClass) {
      const div = document.createElement('div');
      div.textContent = message;
      div.classList.add(senderClass);
      chatMessages.appendChild(div);
      chatMessages.scrollTop = chatMessages.scrollHeight;
    }

    socket.on('waiting', () => {
      waitingDiv.style.display = 'block';
      gameDiv.style.display = 'none';
    });

    socket.on('start', (data) => {
      playerId = data.playerId;
      waitingDiv.style.display = 'none';
      gameDiv.style.display = 'block';
      updateUI(data.players);
      setTurn(data.turn === playerId);
    });

    socket.on('update', (data) => {
      updateUI(data.players);
      setTurn(data.turn === playerId);
    });

    attackBtn.onclick = () => {
      if (isMyTurn) {
        socket.emit('attack');
      }
    };

    manaBtn.onclick = () => {
      if (isMyTurn) {
        socket.emit('mana');
      }
    };

    sendChat.onclick = () => {
      const msg = chatInput.value.trim();
      if (msg) {
        socket.emit('chat', msg);
        addChatMessage(`You: ${msg}`, 'you');
        chatInput.value = '';
      }
    };

    socket.on('chat', (message) => {
      addChatMessage(`Enemy: ${message}`, 'enemy');
    });

    socket.on('gameOver', (winnerId) => {
      statusDiv.textContent = winnerId === playerId ? 'You Win!' : 'You Lose!';
      attackBtn.disabled = true;
      manaBtn.disabled = true;
    });
  </script>
</body>
</html>
