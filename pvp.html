<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>1v1 PvP Turn-based Game</title>
<style>
  body { font-family: Arial, sans-serif; background: #222; color: #eee; text-align: center; }
  #game { margin-top: 30px; }
  button { margin: 5px; padding: 10px 20px; font-size: 16px; }
  #status { margin-top: 20px; font-size: 18px; }
  #players { display: flex; justify-content: center; margin-top: 20px; }
  .player-box { margin: 0 20px; padding: 10px; border: 1px solid #555; width: 150px; background: #333; }
  .bar { height: 20px; background: #444; margin: 8px 0; border-radius: 5px; overflow: hidden; }
  .health-bar { background: #e74c3c; height: 100%; }
  .mana-bar { background: #3498db; height: 100%; }
  button:disabled { background: #555; color: #999; cursor: not-allowed; }
</style>
</head>
<body>

<h1>1v1 PvP Turn-Based Game</h1>
<div id="status">Connecting to server...</div>

<div id="players" style="display:none;">
  <div class="player-box">
    <h2>You</h2>
    <div>Health: <span id="player-health">0</span></div>
    <div class="bar"><div id="player-health-bar" class="health-bar" style="width:100%"></div></div>
    <div>Mana: <span id="player-mana">0</span></div>
    <div class="bar"><div id="player-mana-bar" class="mana-bar" style="width:100%"></div></div>
  </div>
  <div class="player-box">
    <h2>Enemy</h2>
    <div>Health: <span id="enemy-health">0</span></div>
    <div class="bar"><div id="enemy-health-bar" class="health-bar" style="width:100%"></div></div>
    <div>Mana: <span id="enemy-mana">0</span></div>
    <div class="bar"><div id="enemy-mana-bar" class="mana-bar" style="width:100%"></div></div>
  </div>
</div>

<div id="game" style="display:none;">
  <button id="attack-btn">Attack (Cost: 10 Mana)</button>
  <button id="defend-btn">Defend (Cost: 5 Mana)</button>
  <button id="skill-btn">Skill (Cost: 20 Mana)</button>
  <button id="mana-btn">Mana Boost (+15 Mana)</button>
</div>

<script src="https://cdn.socket.io/4.6.1/socket.io.min.js"></script>
<script>
  const socket = io('https://pvpbackend.onrender.com');

  const statusDiv = document.getElementById('status');
  const playersDiv = document.getElementById('players');
  const gameDiv = document.getElementById('game');

  const playerHealthSpan = document.getElementById('player-health');
  const enemyHealthSpan = document.getElementById('enemy-health');
  const playerManaSpan = document.getElementById('player-mana');
  const enemyManaSpan = document.getElementById('enemy-mana');

  const playerHealthBar = document.getElementById('player-health-bar');
  const enemyHealthBar = document.getElementById('enemy-health-bar');
  const playerManaBar = document.getElementById('player-mana-bar');
  const enemyManaBar = document.getElementById('enemy-mana-bar');

  const attackBtn = document.getElementById('attack-btn');
  const defendBtn = document.getElementById('defend-btn');
  const skillBtn = document.getElementById('skill-btn');
  const manaBtn = document.getElementById('mana-btn');

  let isMyTurn = false;
  let player = null;
  let enemy = null;

  function updateUI() {
    playerHealthSpan.textContent = player.health;
    enemyHealthSpan.textContent = enemy.health;
    playerManaSpan.textContent = player.mana;
    enemyManaSpan.textContent = enemy.mana;

    playerHealthBar.style.width = player.health + '%';
    enemyHealthBar.style.width = enemy.health + '%';
    playerManaBar.style.width = (player.mana / 50 * 100) + '%';
    enemyManaBar.style.width = (enemy.mana / 50 * 100) + '%';

    // ButonlarÄ± sÄ±raya ve mana durumuna gÃ¶re aktif/pasif yap
    attackBtn.disabled = !isMyTurn || player.mana < 10;
    defendBtn.disabled = !isMyTurn || player.mana < 5;
    skillBtn.disabled = !isMyTurn || player.mana < 20;
    manaBtn.disabled = !isMyTurn || player.mana >= 50;
  }

  function setStatus(text) {
    statusDiv.textContent = text;
  }

  socket.on('connect', () => {
    setStatus('Connected. Waiting for opponent...');
  });

  socket.on('waitingForOpponent', () => {
    setStatus('Waiting for opponent...');
  });

  socket.on('gameStart', (data) => {
    player = data.player;
    enemy = data.enemy;
    isMyTurn = true; // Oyuncu 1 her zaman baÅŸlar backend'e gÃ¶re

    playersDiv.style.display = 'flex';
    gameDiv.style.display = 'block';
    updateUI();
    setStatus('Game started! Your turn.');
  });

  socket.on('moveConfirmed', (data) => {
    player = data.player;
    enemy = data.enemy;
    isMyTurn = false;
    updateUI();
    setStatus("Opponent's turn. Please wait...");
  });

  socket.on('enemyMove', (data) => {
    // Rakibin hamlesi geldiÄŸinde sÄ±ra tekrar sana geÃ§er
    player = data.enemy;
    enemy = data.player;
    isMyTurn = true;
    updateUI();
    setStatus('Your turn.');
  });

  socket.on('errorMessage', (msg) => {
    alert(msg);
  });

  socket.on('gameOver', (data) => {
    if(data.winner === 'player') {
      setStatus('You won the game! ðŸŽ‰');
    } else {
      setStatus('You lost the game.');
    }
    isMyTurn = false;
    updateUI();
    // Oyunu yeniden baÅŸlatmak iÃ§in sayfayÄ± yenileyebilir veya yeniden baÄŸlanabilirsin
  });

  function sendMove(move) {
    if (!isMyTurn) {
      alert("It's not your turn!");
      return;
    }
    socket.emit('playerMove', { move });
  }

  attackBtn.onclick = () => sendMove('attack');
  defendBtn.onclick = () => sendMove('defend');
  skillBtn.onclick = () => sendMove('skill');
  manaBtn.onclick = () => sendMove('mana');

</script>

</body>
</html>
